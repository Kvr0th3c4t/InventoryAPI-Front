@page "/productos-detalle/{Id:int}"
@attribute [AuthorizeAttribute]
@inject IProductoService ProductoService
@inject NavigationManager NavigationManager

<PageTitle>Detalle de Producto</PageTitle>

@if (producto == null)
{
    <MudText Typo="Typo.h6" Color="Color.Primary">Cargando producto...</MudText>
}
else
{
    <TitleCard Title=@($"Detalle: {producto.Nombre}")></TitleCard>

    <MudGrid Spacing="3" Class="mt-4">

        <MudItem xs="12" md="4">
            <MudPaper Elevation="2" Class="pa-4">
                <MudImage Src="https://placehold.co/375x495?text=Imagen+Producto" Alt="@producto.Nombre" Elevation="0"
                    Class="rounded-lg" />
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="8">
            <MudPaper Elevation="2" Class="pa-4">
                <MudStack Spacing="3">

                    <div>
                        <MudText Typo="Typo.h4" Class="mb-2">@producto.Nombre</MudText>
                        <MudText Typo="Typo.body1" Color="Color.Dark">@producto.Descripcion</MudText>
                    </div>

                    <MudDivider />

                    <MudSimpleTable Elevation="0" Dense="true">
                        <tbody>
                            <tr>
                                <td style="width: 150px;">
                                    <MudText Typo="Typo.body2"><strong>SKU</strong></MudText>
                                </td>
                                <td>
                                    <MudText Typo="Typo.body2">@producto.SKU</MudText>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <MudText Typo="Typo.body2"><strong>Categoría</strong></MudText>
                                </td>
                                <td>
                                    <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Filled">
                                        @producto.CategoriaNombre
                                    </MudChip>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <MudText Typo="Typo.body2"><strong>Proveedor</strong></MudText>
                                </td>
                                <td>
                                    <MudChip T="string" Size="Size.Small" Color="Color.Secondary" Variant="Variant.Filled">
                                        @producto.ProveedorNombre
                                    </MudChip>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <MudText Typo="Typo.body2"><strong>Precio unitario</strong></MudText>
                                </td>
                                <td>
                                    <MudText Typo="Typo.h6" Color="Color.Success">@producto.Precio.ToString("C2")</MudText>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <MudText Typo="Typo.body2"><strong>Stock disponible</strong></MudText>
                                </td>
                                <td>
                                    <MudChip T="string" Size="Size.Medium"
                                        Color="@(producto.StockActual > 10 ? Color.Success : Color.Warning)"
                                        Variant="Variant.Filled">
                                        @producto.StockActual unidades
                                    </MudChip>
                                </td>
                            </tr>
                        </tbody>
                    </MudSimpleTable>

                    <MudDivider />

                    <MudGrid Spacing="2">
                        <MudItem xs="6" sm="4">
                            <MudPaper Elevation="0" Class="pa-3"
                                Style="background-color: var(--mud-palette-background-grey);">
                                <MudText Typo="Typo.caption" Color="Color.Default">ID Producto</MudText>
                                <MudText Typo="Typo.body1"><strong>@producto.Id</strong></MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="6" sm="4">
                            <MudPaper Elevation="0" Class="pa-3"
                                Style="background-color: var(--mud-palette-background-grey);">
                                <MudText Typo="Typo.caption" Color="Color.Default">Valor en stock</MudText>
                                <MudText Typo="Typo.body1"><strong>@((producto.Precio *
                                                                            producto.StockActual).ToString("C2"))</strong></MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="6" sm="4">
                            <MudPaper Elevation="0" Class="pa-3"
                                Style="background-color: var(--mud-palette-background-grey);">
                                <MudText Typo="Typo.caption" Color="Color.Default">Estado</MudText>
                                <MudText Typo="Typo.body1"><strong>@(producto.StockActual > 0 ? "Disponible" :
                                                                            "Agotado")</strong></MudText>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>

                    <!-- Botones de acción -->
                    <MudStack Row="true" Spacing="2" Justify="Justify.FlexEnd" Class="mt-2">
                        <MudButton Variant="Variant.Outlined" Color="Color.Default"
                            StartIcon="@Icons.Material.Filled.ArrowBack" OnClick="@Volver">
                            Volver
                        </MudButton>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Edit"
                            OnClick="@Editar">
                            Editar
                        </MudButton>
                    </MudStack>

                </MudStack>
            </MudPaper>
        </MudItem>
    </MudGrid>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private ProductoResponseDto? producto;

    protected override async Task OnParametersSetAsync()
    {
        producto = await ProductoService.GetProductoByIdAsync(Id);
    }

    private void Volver()
    {
        NavigationManager.NavigateTo("/productos-lista");
    }
    private void Editar()
    {
        NavigationManager.NavigateTo($"/productos-editar/{Id}");
    }
}